@USE_COUNTER_PLESUREBEAST(듀얼리스트,종류,ゾーン,場所,要求個数)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC 要求個数

CALL FULLRESET
효과範囲필드 = 1
효과範囲마함 = 1
효과範囲상대필드 = 1
효과範囲상대마함 = 1
효과条件CNT = 1
CALL CARD_CHECK_ADV(듀얼리스트,종류,ゾーン,場所)
IF RESULT:10 < 要求個数
	PRINTFORMW 악성 카운터의 총 수가 필요한 개수에 부족해졌습니다
	RETURN 0
ENDIF

DO
	CALL FULLRESET
	효과範囲필드 = 1
	효과範囲마함 = 1
	효과範囲상대필드 = 1
	효과範囲상대마함 = 1
	효과条件悪Ｃ所持 = 999
	CALL CARD_CHOOSE_ADV(듀얼리스트,ゾーン,場所)
	IF RESULT != 9999
		CALL CARD_SELECT(듀얼리스트,RESULT)
		CALL SET_FIELD_INFO(대상者（CS）,参照先（CS）,選択カード（CS）,"悪Ｃ",-1)
		要求個数 --
	ELSE
		RETURN 0
	ENDIF
LOOP 要求個数 > 0
RETURN 1

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
; 덱上級괴한수의 각성時の戦闘破壊괴한플랜트化共通処理
; (저아이즈は除く)
@SEEDBED_PLEASUREBEAST(듀얼리스트,종류,ゾーン,場所,조교수 = -1)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 対面者
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC 조교수
#DIMS DYNAMIC 보존ヒロインネーム
#DIM DYNAMIC 보존変身元ID
#DIM DYNAMIC 괴한플랜트위치
#DIMS DYNAMIC 괴한플랜트名前
#DIM DYNAMIC 조교カードID

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

CALL FULLRESET
괴한플랜트위치 = 現마함(対面者)
CALLFORM CARDNAME_{直前戦闘破壊ID(듀얼리스트,1)}("名前")
괴한플랜트名前 = %RESULTS%
CALLFORM CARDNAME_{直前戦闘破壊ID(듀얼리스트,1)}("カテゴリ")
IF MATCH(RESULTS, "계한전희")
	보존ヒロインネーム = %GETVARS(@"%対面者%_MZ_戒悍ネーム:{戦姫戦闘場所}")%
	보존変身元ID = GETVAR(@"%対面者%_MZ_戒悍変身元ID:{戦姫戦闘場所}")
	SETVAR @"%対面者%_MZ_戒悍ネーム:{戦姫戦闘場所}",""
	SETVAR @"%対面者%_MZ_戒悍変身元ID:{戦姫戦闘場所}",0
ENDIF
CALL FULLRESET
효과条件名前 = %괴한플랜트名前%
IF 괴한플랜트元オーナー == 1
	효과範囲묘지 = 1
	CALL CARD_SET_ADV(듀얼리스트,ゾーン,場所,"表側표시",2)
ELSE
	효과範囲상대묘지 = 1
	CALL CARD_SET_ADV(듀얼리스트,ゾーン,場所,"表側표시",1)
ENDIF
조교カードID = RESULT:1
IF 보존ヒロインネーム != ""
	CALL CARD_SET_RENAME(対面者,"마함",괴한플랜트위치,보존ヒロインネーム)
	CALL CARD_SET_CATEGORY(対面者,"마함",괴한플랜트위치,"계한전희")
	CALL CARD_SET_CATEGORY(対面者,"마함",괴한플랜트위치,"괴한플랜트",1)
	SETVAR @"%対面者%_魔_戒悍ネーム:{괴한플랜트위치}",보존ヒロインネーム
ELSE
	CALL CARD_SET_CATEGORY(対面者,"마함",괴한플랜트위치,"괴한플랜트")
ENDIF
IF 보존変身元ID != 0
	SETVAR @"%対面者%_魔_戒悍変身元ID:{괴한플랜트위치}",보존変身元ID
ENDIF
SIF 보존変身元ID != 0
	조교カードID = 보존変身元ID
; CALL STATCHANGE_OTHER(対面者,"마함",괴한플랜트위치,"性",1)
CALL KOJO_PLEASUREBEAST_MANAGER(조교カードID,"戦闘破壊",조교수,보존ヒロインネーム)

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
; エンドフェイズの괴한수維持コスト
@MAINTAIN_PLEASUREBEAST(듀얼리스트,종류,ゾーン,場所,조교수 = -1)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 対面者
#DIM DYNAMIC 조교수
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 選択カード
#DIM DYNAMIC 選択カードID
#DIMS DYNAMIC 選択カードゾーン
#DIM DYNAMIC 조교カードID
#DIM DYNAMIC 戦闘カード
#DIM DYNAMIC 戦姫플래그
#DIMS DYNAMIC カード名前

CALL FULLRESET
효과範囲필드 = 1
효과範囲마함 = 1
효과範囲상대필드 = 1
효과範囲상대마함 = 1
효과条件カテゴリ = 괴한플랜트
CALL CARD_CHECK_ADV(듀얼리스트,종류,ゾーン,場所)
IF RESULT != 1
	CALL CARD_DISPOSE(듀얼리스트,ゾーン,場所,破壊行き)
ELSE
	CALL CARD_CHOOSE_ADV(듀얼리스트,ゾーン,場所)
	IF RESULT != 9999
		選択カード = RESULT
		選択カードID = RESULT:99
		IF 参照先（CS） == "필드"
			選択カードゾーン = MZ
		ELSEIF 参照先（CS） == "마함"
			選択カードゾーン = 魔
		ENDIF
		IF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_改名:{選択カード（CS）}") != ""
			カード名前 = %GETVARS(@"%대상者（CS）%_%選択カードゾーン%_改名:{選択カード（CS）}")%
			IF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ:{選択カード（CS）}") == "괴한수"
				戦姫플래그 = 2
			ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ2:{選択カード（CS）}") == "괴한수"
				戦姫플래그 = 2
			ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ:{選択カード（CS）}") == "계한전희"
				戦姫플래그 = 1
			ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ2:{選択カード（CS）}") == "계한전희"
				戦姫플래그 = 1
			ENDIF

		ELSE
			CALLFORM CARDNAME_{選択カードID}("名前")
			カード名前 = %RESULTS%
			TRYCALLFORM CARDNAME_{GETVAR(@"%대상者（CS）%_%参照先（CS）%:選択カード（CS）")}("カテゴリ")
			IF MATCH(RESULTS, "괴한수")
				戦姫플래그 = 2
			ELSEIF MATCH(RESULTS, "계한전희")
				戦姫플래그 = 1
			ENDIF
		ENDIF

		SIF 選択カードゾーン != "魔"
			조교カードID = GETVAR(@"%대상者（CS）%_%選択カードゾーン%_変化元ID:選択カード（CS）")
		SIF 조교カードID < 1
			조교カードID = GETVAR(@"%대상者（CS）%_%選択カードゾーン%_戒悍変身元ID:選択カード（CS）")
		SIF 조교カードID < 1
			조교カードID = 選択カードID
		CALL KOJO_PLEASUREBEAST_MANAGER(조교カードID,"プラント使用",조교수,カード名前,,戦姫플래그)
		PRINTFORM %カード名前%『{選択カード}』에 악성 카운터가
		TRYCALLFORM CARDNAME_{GETVAR(@"%대상者（CS）%_%参照先（CS）%:選択カード（CS）")}("カテゴリ")
		IF !GROUPMATCH(RESULTS, "계한전희")
			CALL SET_FIELD_INFO(대상者（CS）,参照先（CS）,選択カード（CS）,"悪Ｃ",1)
			PRINTFORM １
		ELSE
			CALL SET_FIELD_INFO(대상者（CS）,参照先（CS）,選択カード（CS）,"悪Ｃ",2)
			PRINTFORM ２
		ENDIF
		PRINTFORMW 개 놓였습니다。
	ENDIF
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
; 프레세리아특수소환用関数
; (CARD_EX_SUMMONを改造したもの)
@CARD_EX_SUMMON_PLEASUREHEROIN(듀얼리스트,選択カード,変身カードID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 出処;덱、패、필드、마함のいずれかを渡す
#DIMS DYNAMIC 표시形式
#DIM DYNAMIC 選択カード
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC LRESULT
#DIM DYNAMIC 所有先
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 이동カード名
#DIM DYNAMIC 소환出処
#DIM DYNAMIC 회복量

#DIM DYNAMIC 変身カードID
#DIMS DYNAMIC ヒロインネーム

LRESULT = RESULT

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF 듀얼리스트 == "자신"
	所有先 = 1
ELSE
	所有先 = 2
ENDIF

;出た場所のデ-タを보존
; ELSEIF 出処 == "EX덱"
소환出処= 5

SETVAR @"%듀얼리스트%_특수소환횟수", GETVAR(@"%対面者%_특수소환횟수") + 1

표시形式 = 攻撃표시

カード소환先 = 現필드(対面者)
SETVAR @"%対面者%_MZ_所有:カード소환先", 所有先
SETVAR @"%対面者%_MZ_召種:カード소환先", 소환出処
SETVAR @"%対面者%_MZ_T1召種:カード소환先", 소환出処
SETVAR @"%対面者%_MZ_戦:カード소환先", 1
個IDカウンタ ++
SETVAR @"%対面者%_MZ_個ID:カード소환先", 個IDカウンタ
SETVAR @"%対面者%_MZ_表:カード소환先", 1
SETVAR @"%対面者%_필드:カード소환先", GETVAR(@"%듀얼리스트%_EX덱:選択カード")
カードID = GETVAR(@"%対面者%_필드:カード소환先")

CALLFORM CARDNAME_{カードID}, "名前"
이동カード名 = %RESULTS%

ARRAYREMOVE 자신_EX덱, 選択カード, 1
자신_EX덱:(VARSIZE("자신_EX덱")-1) = -1

; 프레세리아の独自処理
ヒロインネーム = 프레세리아 
CALL CARD_EROTICS(変身カードID)
IF RESULT != -1
	ヒロインネーム = %ヒロインネーム% %CALLNAME:RESULT%
ELSE
	TRYCALLFORM CARDNAME_{変身カードID}("略称")
	ヒロインネーム = %ヒロインネーム%%RESULTS%
ENDIF
CALL CARD_SET_RENAME(対面者,"필드",カード소환先,ヒロインネーム)
SETVAR @"%対面者%_MZ_戒悍ネーム:カード소환先", ヒロインネーム
SETVAR @"%対面者%_MZ_戒悍変身元ID:カード소환先", 変身カードID
SETVAR @"%対面者%_MZ_変化元ID:カード소환先", 変身カードID
CALL CARD_SET_CATEGORY(対面者,"필드",カード소환先,"계한전희")
CALL KOJO_PLEASUREBEAST_MANAGER(変身カードID,"変身",,ヒロインネーム)
; ここまで独自処理

TRYCALLFORM CARD_FINISHER_SHOKO(듀얼리스트,カードID)
TRYCALLFORM CARD_FINISHER(듀얼리스트,カードID)

IF 듀얼리스트 == "상대"
	CALL KOJO_MESSAGE_SEND("DUEL",OPPOSER,2,カードID,소환出処)
ENDIF

PRINTFORML %듀얼리스트%는 %出処%에서 『{選択カード}』%이동カード名%를 특수 소환했습니다。
CALL PRINT_STATE_DUEL(カードID)
PRINTFORMW

CALL CARD_ADDITIONAL_EFFECT(듀얼리스트)

;0から4のまでの필드를 확인하고、ステータス変動を確認する
CALL CARD_LOADUP

IF カードID
	CALL CARD_FIN_BIT_SET(듀얼리스트,出処)
	CALLFORM CARD_SS_USE(듀얼리스트,カードID)

	CALL CARD_SUMRESERV(듀얼리스트,"특수",カード소환先 ,カードID,出処)
	CALL CARD_SUMRESERV(対面者,"EX특수",カード소환先 ,カードID,出処)
	;효과발동前に
	CALL CARD_SUMACT(듀얼리스트,"EX특수",カード소환先,カードID,듀얼리스트,出処)
	IF カードID == GETVAR(@"%対面者%_필드:カード소환先")
		IF GETVAR(@"%対面者%_みずき효과")
			회복量 = GETVAR(@"%対面者%_MZ_攻:カード소환先")
			CALL LIFE_CHANGE(対面者,"増加","효과",회복量)
		ENDIF
		CALLFORM CARD_STANBY(カードID,対面者,특수소환時,"필드",カード소환先)

		VARSET RESULT
		TRYCALLFORM CARDCAN_{カードID}(対面者,특수소환時強制,"필드",カード소환先)
		SIF RESULT == 1
			TRYCALLFORM CARDEFFECT_{カードID}(対面者,특수소환時強制,"필드",カード소환先)
	ENDIF
ENDIF

RESULT = LRESULT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
; 臨時プラントセット用
; (CARD_ADDを改造したもの)
@CARD_ADD_PLEASUREBEAST_EMERGENCYPLANT(듀얼리스트,選択カード)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 듀얼리스트보존
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 保有者
#DIMS DYNAMIC 配置者

#DIMS DYNAMIC 出処;덱、패、필드、마함のいずれかを渡す
#DIMS DYNAMIC 추가場所;덱、패、필드、마함のいずれかを渡す
#DIMS DYNAMIC 표시形式
#DIM DYNAMIC 所有先
#DIM DYNAMIC 選択カード
#DIM DYNAMIC カード추가先
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIMS DYNAMIC 이동カード名
#DIM DYNAMIC LRESULT
LRESULT = RESULT

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

표시形式 = "表側표시"

IF 듀얼리스트 == "자신"
	所有先 = 1
	保有者 = 자신
ELSEIF 듀얼리스트 == "상대"
	所有先 = 2
	保有者 = 상대
ENDIF

IF 마함数(対面者) >= 5
	추가場所 = 묘지
ELSE
	カード추가先 = 現마함(対面者)
ENDIF

SIF 추가場所 == "묘지"
  	カード추가先 = 現묘지数(듀얼리스트)

IF カード추가先 >= 99
	PRINTFORMW OVERFLOW！！！
	GOTO SKIP_ADD
ENDIF

カードID = GETVAR(@"%対面者%_필드:選択カード")

IF 추가場所 == "묘지"
		SETVAR @"%듀얼리스트%_묘지:カード추가先", カードID
ELSE
	カード설치先 = カード추가先
	SETVAR @"%対面者%_魔_所有:カード추가先", 所有先
	SETVAR @"%対面者%_魔_表:カード추가先", 1
	SETVAR @"%対面者%_마함:カード추가先", カードID
	CALL CARD_ADDITIONAL_EFFECT(対面者,1)
ENDIF


$SKIP_ADD
CALLFORM CARDNAME_{カードID}, "名前"
이동カード名 = %RESULTS%

SETVAR @"%対面者%_필드:選択カード", -1

IF カード추가先 >= 99
	PRINTFORML %이동カード名%는 소멸했습니다。
ELSEIF 추가場所 == "묘지" 
	PRINTFORML %듀얼리스트%는 필드에서 %이동カード名%를 묘지에 떨어뜨렸습니다。	
ELSE
	PRINTFORML %듀얼리스트%는 필드에서 %이동カード名%를 마법 / 함정존에 세트했습니다。
ENDIF

;카드가 最召場所から이동している場合は、リセットされるように。
IF GETVAR(@"%듀얼리스트%_最召場所") == 選択カード
	SETVAR @"%듀얼리스트%_最召場所", -1
ENDIF

PRINTFORMW
;0から4のまでの필드를 확인하고、ステータス変動を確認する
CALL CARD_LOADUP

RESULT = LRESULT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
; 괴한플랜트조교処理
; 直前にプラントをSELECTしているのが前提
@TRAIN_PLEASUREBEAST(듀얼리스트,選択カード,選択カードID,조교수 = -1,複数플래그 = 0,횟수플래그 = 0,Ｃ報告不要 = 0)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 조교수
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 選択カード
#DIM DYNAMIC 選択カードID
#DIMS DYNAMIC 選択カードゾーン
#DIM DYNAMIC 조교カードID
#DIM DYNAMIC 戦闘カード
#DIM DYNAMIC 戦姫플래그
#DIM DYNAMIC 複数플래그
#DIM DYNAMIC 횟수플래그
#DIM DYNAMIC Ｃ報告不要
#DIMS DYNAMIC カード名前

IF 参照先（CS） == "필드"
	選択カードゾーン = MZ
ELSEIF 参照先（CS） == "마함"
	選択カードゾーン = 魔
ENDIF
IF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_改名:{選択カード（CS）}") != ""
	カード名前 = %GETVARS(@"%대상者（CS）%_%選択カードゾーン%_改名:{選択カード（CS）}")%
	IF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ:{選択カード（CS）}") == "괴한수"
		戦姫플래그 = 2
	ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ2:{選択カード（CS）}") == "괴한수"
		戦姫플래그 = 2
	ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ:{選択カード（CS）}") == "계한전희"
		戦姫플래그 = 1
	ELSEIF GETVARS(@"%대상者（CS）%_%選択カードゾーン%_追カテ2:{選択カード（CS）}") == "계한전희"
		戦姫플래그 = 1
	ENDIF
ELSE
	CALLFORM CARDNAME_{選択カードID}("名前")
	カード名前 = %RESULTS%
	TRYCALLFORM CARDNAME_{GETVAR(@"%대상者（CS）%_%参照先（CS）%:選択カード（CS）")}("カテゴリ")
	IF MATCH(RESULTS, "괴한수")
		戦姫플래그 = 2
	ELSEIF MATCH(RESULTS, "계한전희")
		戦姫플래그 = 1
	ENDIF
ENDIF
SIF 選択カードゾーン != "魔"
	조교カードID = GETVAR(@"%대상者（CS）%_%選択カードゾーン%_変化元ID:選択カード（CS）")
SIF 조교カードID < 1
	조교カードID = GETVAR(@"%대상者（CS）%_%選択カードゾーン%_戒悍変身元ID:選択カード（CS）")
SIF 조교カードID < 1
	조교カードID = 選択カードID
CALL KOJO_PLEASUREBEAST_MANAGER(조교カードID,"プラント使用",조교수,カード名前,,戦姫플래그,複数플래그,횟수플래그)
IF !Ｃ報告不要
	PRINTFORM %カード名前% 에 카운터가
	TRYCALLFORM CARDNAME_{GETVAR(@"%대상者（CS）%_%参照先（CS）%:選択カード（CS）")}("カテゴリ")
	IF !GROUPMATCH(RESULTS, "계한전희")
		CALL SET_FIELD_INFO(대상者（CS）,参照先（CS）,選択カード（CS）,"悪Ｃ",1)
		PRINTFORM １
	ELSE
		CALL SET_FIELD_INFO(대상者（CS）,参照先（CS）,選択カード（CS）,"悪Ｃ",2)
		PRINTFORM ２
	ENDIF
	PRINTFORMW 개 놓였습니다。
ENDIF
